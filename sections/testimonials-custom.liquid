<section id="ReviewCarouselSection" class="py-16 md:py-24">
  <div class="max-w-7xl mx-auto px-4 text-center">
    <div
      class="js-reviews-carousel"
      data-flickity='
        {
          "wrapAround": true,
          "autoPlay": 5000,
          "prevNextButtons": false,
          "pageDots": false,
          "cellAlign": "center",
          "contain": true
        }
      '
    >
      {% for block in section.blocks %}
        <div class="w-full px-6">
          <div class="text-xl flex gap-1 items-center justify-center text-[#273A27] tracking-widest mb-6">
            {% for i in (1..block.settings.stars) limit: 5 %}
              <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.3583 6.66667L8.33333 0L6.30833 6.66667H0L5.15 10.3417L3.19167 16.6667L8.33333 12.7583L13.4833 16.6667L11.525 10.3417L16.6667 6.66667H10.3583Z" fill="#273A27"/>
              </svg>
            {% endfor %}
          </div>

          <p class="text-3xl md:text-5xl font-serif italic leading-normal mb-6">
            <em>"{{ block.settings.quote }}"</em>
          </p>

          <p class="text-2xl uppercase tracking-wider">
            {{ block.settings.author }}
          </p>
        </div>
      {% endfor %}
    </div>

    <!-- CUSTOM DOTS -->
    <div id="review-dots" class="flex justify-center mt-6 space-x-2">
      {% for block in section.blocks %}
        <button
          data-index="{{ forloop.index0 }}"
          class="review-dot cursor-pointer h-[10px] w-[10px] rounded-full border border-[#273A27] transition-colors duration-300"
        ></button>
      {% endfor %}
    </div>
  </div>
</section>

<style>
  {% comment %} .review-flickity-carousel {
    width: 100%;
  }

  .carousel-cell {
    width: 100%;
    text-align: center;
  }

  /* Optional: adjust Flickity dots */
  .flickity-page-dots .dot {
    background: #d1d5db !important; /* gray-300 */
    width: 8px;
    height: 8px;
    opacity: 1 !important;
  }

  .flickity-page-dots .dot.is-selected {
    background: #000 !important;
    transform: scale(1.2);
  } {% endcomment %}
</style>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var carousel = document.querySelector('.js-reviews-carousel');
    if (!carousel) return;

    var flkty = new Flickity(carousel);

    var dots = document.querySelectorAll('.review-dot');

    function updateDots(index) {
      dots.forEach((dot, i) => {
        dot.classList.toggle('bg-[#273A27]', i === index);
        dot.classList.toggle('bg-transparent', i !== index);
      });
    }

    flkty.on('change', function (index) {
      updateDots(index);
    });

    dots.forEach((dot, i) => {
      dot.addEventListener('click', function () {
        flkty.select(i);
      });
    });

    updateDots(0); // initial
  });
</script>
{% schema %}
{
  "name": "Sliding Testimonials",
  "tag": "section",
  "class": "section-review-carousel",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background Color",
      "default": "#fbfaf7"
    }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review",
      "settings": [
        {
          "type": "textarea",
          "id": "quote",
          "label": "Review Quote",
          "default": "Uniquely and beautifully designed and high quality products, especially bed linen and even all kinds of artifacts."
        },
        {
          "type": "text",
          "id": "author",
          "label": "Author Name",
          "default": "Pooja Panreja"
        },
        {
          "type": "number",
          "id": "stars",
          "label": "Stars",
          "default": 5
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Sliding Testimonials Carousel",
      "blocks": [{ "type": "review" }, { "type": "review" }, { "type": "review" }]
    }
  ]
}
{% endschema %}
