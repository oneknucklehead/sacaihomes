{% comment %}
  Collection Slider Section
  - Desktop/Tablet: SwiperJS Slider
  - Mobile: Horizontal scroll
{% endcomment %}

{{ 'section-collection-list.css' | asset_url | stylesheet_tag }}
{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-slider.css' | asset_url | stylesheet_tag }}

<div class="collection-slider-section page-width section-{{ section.id }}-padding">
  {%- unless section.settings.title == blank -%}
    <h2 class="collection-list-title text-center mb-8">{{ section.settings.title }}</h2>
  {%- endunless -%}

  <!-- Desktop/Tablet Slider -->
  <div class="swiper-container hidden md:block" id="collectionSwiper-{{ section.id }}">
    <div class="swiper-wrapper">
      {% for block in section.blocks %}
        {% assign collection = block.settings.collection %}
        {% if collection %}
          <div class="swiper-slide">
            {% render 'card-collection',
              card_collection: collection,
              media_aspect_ratio: section.settings.image_ratio,
              placeholder_image: 'collection-placeholder'
            %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <!-- Navigation -->
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>

  <!-- Mobile Horizontal Scroll -->
  <div class="flex md:hidden space-x-4 overflow-x-auto pb-4 snap-x snap-mandatory">
    {% for block in section.blocks %}
      {% assign collection = block.settings.collection %}
      {% if collection %}
        <div class="flex-shrink-0 w-3/4 snap-center">
          {% render 'card-collection',
            card_collection: collection,
            media_aspect_ratio: section.settings.image_ratio,
            placeholder_image: 'collection-placeholder'
          %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</div>

<!-- SwiperJS -->
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js" defer></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const swiperEl = document.getElementById('collectionSwiper-{{ section.id }}');
    if (swiperEl) {
      new Swiper(swiperEl, {
        slidesPerView: 3,
        spaceBetween: 24,
        slidesPerGroup: 3,
        loop: false,
        navigation: {
          nextEl: '.swiper-button-next',
          prevEl: '.swiper-button-prev',
        },
        speed: 600,
        breakpoints: {
          768: { slidesPerView: 2, slidesPerGroup: 2 },
          1024: { slidesPerView: 3, slidesPerGroup: 3 },
        },
      });
    }
  });
</script>

{%- style -%}
  .collection-slider-section {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }
  @media screen and (min-width: 750px) {
    .collection-slider-section {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }
{%- endstyle -%}

{% schema %}
{
  "name": "Collection Slider",
  "tag": "section",
  "max_blocks": 15,
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "SHOP OUR COLLECTIONS"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image Ratio",
      "options": [
        { "value": "square", "label": "Square" },
        { "value": "portrait", "label": "Portrait" },
        { "value": "adapt", "label": "Adapt" }
      ],
      "default": "square"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Top (px)",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom (px)",
      "min": 0,
      "max": 100,
      "step": 4,
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Collection",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Select Collection"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection Carousel",
      "category": "Collections",
      "blocks": [{ "type": "collection" }, { "type": "collection" }, { "type": "collection" }]
    }
  ]
}
{% endschema %}
