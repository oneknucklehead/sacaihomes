{% comment %}
  Collection Carousel Section
  Shows 3 collections at a time with arrow navigation, responsive, smooth animation.
{% endcomment %}

<div class="collection-carousel-section bg-[#f9f9f9] py-10">
  <div class="max-w-7xl mx-auto px-4">
    {% if section.settings.heading != blank %}
      <h2 class="text-3xl font-semibold text-center mb-8">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="relative">
      <!-- Left Arrow -->
      <button
        id="prevBtn-{{ section.id }}"
        class="absolute left-0 top-1/2 -translate-y-1/2 z-10 bg-white shadow-md rounded-full p-2 hover:bg-gray-100"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15 19l-7-7 7-7" />
        </svg>
      </button>

      <!-- Carousel Container -->
      <div class="overflow-hidden">
        <div
          id="carouselTrack-{{ section.id }}"
          class="flex transition-transform duration-500 ease-in-out"
          style="transform: translateX(0);"
        >
          {% for collection in collections %}
            <div class="w-1/3 px-3 flex-shrink-0">
              <a
                href="{{ collection.url }}"
                class="block bg-white shadow-md rounded-lg overflow-hidden hover:shadow-xl transition"
              >
                {% if collection.image %}
                  <img
                    src="{{ collection.image | img_url: '800x' }}"
                    alt="{{ collection.title }}"
                    class="w-full h-64 object-cover"
                  >
                {% endif %}
                <div class="p-4 text-center">
                  <h3 class="text-lg font-semibold">{{ collection.title }}</h3>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- Right Arrow -->
      <button
        id="nextBtn-{{ section.id }}"
        class="absolute right-0 top-1/2 -translate-y-1/2 z-10 bg-white shadow-md rounded-full p-2 hover:bg-gray-100"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 5l7 7-7 7" />
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const track = document.getElementById('carouselTrack-{{ section.id }}');
    const prev = document.getElementById('prevBtn-{{ section.id }}');
    const next = document.getElementById('nextBtn-{{ section.id }}');
    const items = track.children.length;
    const visible = 3;
    let index = 0;

    const updateCarousel = () => {
      const shift = -(index * 100) / visible;
      track.style.transform = `translateX(${shift}%)`;
    };

    next.addEventListener('click', () => {
      if (index < items - visible) {
        index++;
        updateCarousel();
      }
    });

    prev.addEventListener('click', () => {
      if (index > 0) {
        index--;
        updateCarousel();
      }
    });

    // Responsive behavior
    const resizeObserver = new ResizeObserver(() => {
      if (window.innerWidth < 768) {
        visible = 1;
      } else if (window.innerWidth < 1024) {
        visible = 2;
      } else {
        visible = 3;
      }
      updateCarousel();
    });
    resizeObserver.observe(document.body);
  });
</script>

{% schema %}
{
  "name": "Collection Carousel",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop Our Collections"
    }
  ],
  "presets": [
    {
      "name": "Collection Slider",
      "category": "Custom"
    }
  ]
}
{% endschema %}
